<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-R">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konverter Teks Biasa ke HTML</title>
    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Menambahkan Google Font "Inter" -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Kustomisasi scrollbar */
        textarea::-webkit-scrollbar,
        div[contenteditable="true"]::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-track,
        div[contenteditable="true"]::-webkit-scrollbar-track {
            background: #1e293b; /* bg-slate-800 */
        }
        textarea::-webkit-scrollbar-thumb,
        div[contenteditable="true"]::-webkit-scrollbar-thumb {
            background: #475569; /* bg-slate-600 */
            border-radius: 4px;
        }
        textarea::-webkit-scrollbar-thumb:hover,
        div[contenteditable="true"]::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* bg-slate-500 */
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style untuk link di dalam tab preview */
        #tabPreview a {
            color: #0891b2; /* text-cyan-600 */
            text-decoration: underline;
        }
        #tabPreview strong { font-weight: bold; }
        #tabPreview em { font-style: italic; }
        #tabPreview s { text-decoration: line-through; }

        /* Animasi Spinner */
        .spinner {
            width: 56px;
            height: 56px;
            border: 6px solid #1e293b; /* slate-800 */
            border-top-color: #22d3ee; /* cyan-400 */
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        /* Style untuk tombol format */
        .format-btn {
            background-color: #334155; /* bg-slate-700 */
            color: #cbd5e1; /* text-slate-300 */
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            border: 1px solid #475569; /* border-slate-600 */
        }
        .format-btn:hover {
            background-color: #475569; /* bg-slate-600 */
            color: #e2e8f0; /* text-slate-200 */
        }

        /* PERUBAHAN BESAR: Style untuk editor contenteditable baru */
        div[contenteditable="true"] {
            /* Meniru style textarea sebelumnya */
            height: 350px;
            background-color: #0f172a; /* bg-slate-900 */
            border: 1px solid #334155; /* border-slate-700 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem; /* p-4 */
            color: #e2e8f0; /* text-slate-200 */
            transition: all 0.3s ease;
            overflow-y: auto; /* overflow-auto */
            line-height: 1.5;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        div[contenteditable="true"]:focus {
            outline: none;
            border-color: #06b6d4; /* ring-cyan-500 */
            box-shadow: 0 0 0 2px #06b6d4; /* ring-2 */
        }
        /* Placeholder kustom untuk div contenteditable */
        div[contenteditable="true"]:empty:before {
            content: "[Komitmen] Pernyataan komitmen, meliputi:\A\A1. membayar kompensasi data informasi;\A2. tidak memindahtangankan IUP kepada pihak lain;\A\ACoba tempel link seperti www.google.com di sini.\A\ACoba juga format tebal, miring, atau coret.";
            color: #64748b; /* text-slate-500 */
            white-space: pre-wrap; /* Hormati newline \A */
            pointer-events: none; /* Izinkan klik "melalui" placeholder */
            display: block;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 min-h-screen flex items-center justify-center p-4">

    <div class="bg-slate-800 p-6 sm:p-10 rounded-2xl shadow-2xl w-full max-w-6xl"> 
        <h1 class="text-3xl font-bold mb-4 text-center text-cyan-400">Konverter Teks ke HTML</h1>
        <p class="text-center text-slate-400 mb-8">Tulis atau tempel teks biasa di editor kiri. Kode HTML akan otomatis dibuat di sebelah kanan.</p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <div>
                <label for="textInput" class="block mb-2 text-lg font-semibold text-slate-300">Editor Teks (Input)</label>
                
                <!-- PERUBAHAN: Menambahkan flex-wrap agar toolbar rapi di HP -->
                <div class="flex items-center flex-wrap gap-2 mb-2 p-2 bg-slate-700 rounded-lg">
                    <button id="formatBoldBtn" class="format-btn font-bold" title="Buat tebal (Pilih teks & klik)">
                        B
                    </button>
                    <button id="formatItalicBtn" class="format-btn italic" title="Buat miring (Pilih teks & klik)">
                        I
                    </button>
                    <button id="formatStrikethroughBtn" class="format-btn line-through" title="Buat coret (Pilih teks & klik)">
                        S
                    </button>
                    <button id="formatColorBtn" class="format-btn" title="Terapkan warna (Pilih teks & klik)">
                        Terapkan Warna
                    </button>
                    <input type="color" id="colorPicker" value="#FFFFFF" class="h-8 w-10 p-0 border-none rounded cursor-pointer bg-slate-700" title="Pilih warna">
                </div>

                <!-- PERUBAHAN BESAR: <textarea> diganti dengan <div contenteditable="true"> -->
                <div id="textInput" 
                     contenteditable="true"
                     class="w-full h-[350px] bg-slate-900 border border-slate-700 rounded-lg p-4 text-slate-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition duration-300 overflow-auto" 
                     spellcheck="false">
                </div>
                
                <div class="mt-4 flex flex-col sm:flex-row gap-3">
                    <button id="continueBtn" class="w-full sm:w-1/2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 shadow-lg flex items-center justify-center gap-2 disabled:opacity-50"
                        title="Lanjutkan teks yang ada di editor menggunakan AI">
                        ✨ Lanjutkan Teks
                    </button>
                    <button id="summarizeBtn" class="w-full sm:w-1/2 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 shadow-lg flex items-center justify-center gap-2 disabled:opacity-50"
                        title="Buat ringkasan dari teks di editor menggunakan AI">
                        ✨ Ringkas Teks
                    </button>
                </div>
                <div id="stats" class="text-sm text-slate-400 mt-3 text-right">
                    Karakter: 0 | Kata: 0
                </div>
            </div>

            <div>
                <label class="block mb-2 text-lg font-semibold text-slate-300">Hasil & Preview</label>

                <div class="flex mb-2">
                    <button id="tabKodeBtn" class="py-2 px-5 rounded-t-lg font-semibold bg-slate-700 text-cyan-400 focus:outline-none z-10 border-b-2 border-cyan-400">
                        Hasil HTML (Kode)
                    </button>
                    <button id="tabPreviewBtn" class="py-2 px-5 rounded-t-lg font-semibold bg-slate-800 text-slate-400 hover:bg-slate-700 focus:outline-none border-b-2 border-slate-700">
                        Preview
                    </button>
                </div>

                <div class="relative top-[-2px]">
                    <div id="tabKode">
                        <textarea id="htmlOutput" 
                                  rows="15" 
                                  readonly 
                                  class="w-full h-[350px] bg-slate-900 border border-slate-700 rounded-b-lg rounded-tr-lg p-4 text-slate-100 font-mono text-sm focus:outline-none resize-none" 
                                  placeholder="<p>
    Hasil HTML akan muncul di sini...
</p>"></textarea>
                    </div>
                    
                    <div id="tabPreview" class="hidden w-full h-[350px] bg-white text-slate-900 border border-slate-700 rounded-b-lg rounded-tr-lg p-4 overflow-auto prose">
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-8 flex flex-col sm:flex-row justify-center items-center gap-4">
            <button id="copyBtn" class="w-full sm:w-auto bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-8 rounded-lg transition duration-300 text-lg shadow-lg">
                Salin Hasil HTML
            </button>
            <button id="clearBtn" class="w-full sm:w-auto bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 px-8 rounded-lg transition duration-300 text-lg shadow-lg">
                Bersihkan Editor
            </button>
        </div>
    </div>

    <div id="copyMessage" class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-green-500 text-white py-2 px-5 rounded-lg shadow-lg hidden transition-all duration-300 opacity-0">
        Teks berhasil disalin!
    </div>

    <div id="loadingModal" class="fixed inset-0 bg-slate-900 bg-opacity-80 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="flex flex-col items-center">
            <div class="spinner"></div>
            <p class="text-xl font-semibold text-cyan-300 mt-4">✨ Memproses... Mohon tunggu...</p>
        </div>
    </div>

    <div id="alertModal" class="fixed inset-0 bg-slate-900 bg-opacity-80 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="bg-slate-700 p-6 rounded-lg shadow-xl max-w-sm w-full mx-4">
            <h3 class="text-lg font-bold text-cyan-400 mb-4">Informasi</h3>
            <p id="alertMessage" class="text-slate-200 mb-6">Ini adalah pesan peringatan.</p>
            <button id="alertOkBtn" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                OK
            </button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const textInput = document.getElementById('textInput'); // Sekarang ini adalah <div>
            const htmlOutput = document.getElementById('htmlOutput');
            const copyBtn = document.getElementById('copyBtn');
            const clearBtn = document.getElementById('clearBtn'); 
            const copyMessage = document.getElementById('copyMessage');
            const stats = document.getElementById('stats'); 

            const continueBtn = document.getElementById('continueBtn');
            const summarizeBtn = document.getElementById('summarizeBtn');
            const loadingModal = document.getElementById('loadingModal');
            const alertModal = document.getElementById('alertModal');
            const alertMessage = document.getElementById('alertMessage');
            const alertOkBtn = document.getElementById('alertOkBtn');

            const formatBoldBtn = document.getElementById('formatBoldBtn'); 
            const formatItalicBtn = document.getElementById('formatItalicBtn');
            const formatStrikethroughBtn = document.getElementById('formatStrikethroughBtn'); 
            const formatColorBtn = document.getElementById('formatColorBtn');
            const colorPicker = document.getElementById('colorPicker');

            const tabKodeBtn = document.getElementById('tabKodeBtn');
            const tabPreviewBtn = document.getElementById('tabPreviewBtn');
            const tabKode = document.getElementById('tabKode');
            const tabPreview = document.getElementById('tabPreview');

            // --- PERUBAHAN: Fungsi untuk membersihkan HTML dari contenteditable ---
            function cleanAndProcessHtml(rawHtml) {
                if (!rawHtml.trim()) {
                    return "";
                }
                let cleaned = rawHtml;

                // 1. Ganti tag styling lama (dari execCommand) ke tag modern
                cleaned = cleaned.replace(/<b\b[^>]*>(.*?)<\/b>/gi, '<strong>$1</strong>');
                cleaned = cleaned.replace(/<i\b[^>]*>(.*?)<\/i>/gi, '<em>$1</em>');
                cleaned = cleaned.replace(/<strike\b[^>]*>(.*?)<\/strike>/gi, '<s>$1</s>');
                
                // 2. Ganti <font color="..."> ke <span style="color:...">
                cleaned = cleaned.replace(/<font color="(.*?)"[^>]*>(.*?)<\/font>/gi, (match, color, text) => {
                    // Pastikan warna aman (hex atau nama)
                    if (/^([a-zA-Z]+|#[0-9a-fA-F]{3,6})$/.test(color)) {
                        return `<span style="color: ${color};">${text}</span>`;
                    }
                    return text; // Kembalikan teks asli jika warna tidak aman
                });

                // BARU: Bersihkan style berantakan dari copy-paste
                // Hanya akan menyimpan `color` dan membuang sisanya
                cleaned = cleaned.replace(/ style="(.*?)"/gi, (match, styleString) => {
                    const colorMatch = styleString.match(/color:\s*([^;"]+)/i);
                    if (colorMatch) {
                        // Validasi warna (rgb, hex, atau nama)
                        const colorValue = colorMatch[1].trim();
                        
                        // PERUBAHAN: Cek apakah ini warna default yang berlebihan
                        // (Browser terkadang menyisipkan rgb(191, 193, 196) atau #e2e8f0)
                        const isDefaultColor = /rgb\(191,\s*193,\s*196\)/.test(colorValue) ||
                                               colorValue.toLowerCase() === '#e2e8f0'; // slate-200
                        
                        // Hanya simpan style jika itu warna yang valid DAN BUKAN warna default
                        if (/^(rgb\([^)]+\)|#[0-9a-fA-F]{3,6}|[a-zA-Z]+)$/.test(colorValue) && !isDefaultColor) {
                            return ` style="color: ${colorValue};"`;
                        }
                    }
                    return ''; // Hapus style yang tidak valid, tidak diinginkan, atau default
                });

                // BARU: Hapus semua atribut `data-*`
                cleaned = cleaned.replace(/ data-[^=]*="[^"]*"/gi, '');
                // BARU: Hapus semua atribut `class`
                cleaned = cleaned.replace(/ class="[^"]*"/gi, '');

                // BARU: Strip table tags from Excel/Word copy-paste
                // Ini akan "meratakan" tabel dan hanya menyimpan teksnya
                
                // PEROMBAKAN LOGIKA TABEL:
                // 1. Ambil konten dari dalam sel <th> dan <td>, tambahkan <br> setelahnya
                // PERBAIKAN: Gunakan [\s\S]*? untuk mencocokkan newline di dalam sel
                cleaned = cleaned.replace(/<th[^>]*>([\s\S]*?)<\/th>/gi, '<strong>$1</strong><br>');
                cleaned = cleaned.replace(/<td[^>]*>([\s\S]*?)<\/td>/gi, '$1<br>');

                // 2. Hapus semua tag tabel lainnya
                cleaned = cleaned.replace(/<\/?tr[^>]*>/gi, '');
                cleaned = cleaned.replace(/<\/?table[^>]*>/gi, '');
                cleaned = cleaned.replace(/<\/?tbody[^>]*>/gi, '');
                cleaned = cleaned.replace(/<\/?thead[^>]*>/gi, '');
                
                // 3. Hapus <br> ganda yang mungkin muncul
                cleaned = cleaned.replace(/<br>\s*<br>/gi, '<br>');


                // 3. Normalisasi paragraf (browser berbeda membuat tag berbeda)
                
                // Hapus <div> atau <p> yang hanya berisi <br> atau kosong
                cleaned = cleaned.replace(/<(div|p)>\s*(<br\s*\/?>)?\s*<\/(div|p)>/gi, '');

                // Ganti <div> yang tersisa (yang dibuat editor per baris) menjadi <p>
                cleaned = cleaned.replace(/<div>([\s\S]*?)<\/div>/gi, '<p>$1</p>');
                
                
                // PERBAIKAN KUNCI: HAPUS LOGIKA YANG SALAH INI
                // cleaned = cleaned.replace(/<br\s*\/?>/gi, '</p><p>');

                // Bungkus teks yatim (jika ada) yang tidak terbungkus tag
                let trimmedCleaned = cleaned.trim();
                
                // Logika ini terlalu rumit dan mungkin menyebabkan masalah.
                // Editor contenteditable seharusnya SELALU membungkus dalam <div> atau <p>
                // Kita sederhanakan saja.
                
                // Hapus <br> di awal atau akhir paragraf
                cleaned = cleaned.replace(/<p>\s*<br\s*\/?>/gi, '<p>');
                cleaned = cleaned.replace(/<br\s*\/?>\s*<\/p>/gi, '</p>');
                
                // Hapus <p> kosong yang mungkin dibuat
                cleaned = cleaned.replace(/<p>\s*<\/p>/gi, '');
                
                // Tambahkan newline setelah setiap </p> untuk keterbacaan di "Hasil HTML"
                cleaned = cleaned.replace(/<\/p>/gi, '</p>\n');


                // HAPUS SEMUA LOGIKA LAMA (if/else, split, map, join)
                /*
                // 1. Ganti SEMUA <br> dengan tag paragraf penutup dan pembuka
                // Ini akan secara efektif mengubah setiap "pindah baris" menjadi "paragraf baru"
                cleaned = cleaned.replace(/<br\s*\/?>/gi, '</p><p>');

                // 2. Bungkus semua yang tersisa (jika belum) dengan <p>
                let trimmedCleaned = cleaned.trim();
                if (trimmedCleaned.length > 0 && !trimmedCleaned.startsWith('<p>')) {
                    trimmedCleaned = `<p>${trimmedCleaned}`;
                }
                if (trimmedCleaned.length > 0 && !trimmedCleaned.endsWith('</p>')) {
                    trimmedCleaned = `${trimmedCleaned}</p>`;
                }
                cleaned = trimmedCleaned;

                // 3. Hapus <p> kosong yang mungkin dibuat
                cleaned = cleaned.replace(/<p>\s*<\/p>/gi, '');
                
                // 4. Tambahkan newline setelah setiap </p> untuk keterbacaan
                cleaned = cleaned.replace(/<\/p>/gi, '</p>\n');
                */
                
                return cleaned.trim(); // Hapus newline terakhir
            }

            // --- BARU: Fungsi untuk mengubah teks biasa (dari AI) ke paragraf HTML ---
            function plainTextToHtmlParagraphs(text) {
                if (!text) return '';
                return '<p>' + text.trim()
                    .replace(/\n{2,}/g, '</p><p>') // Dua newline -> paragraf baru
                    .replace(/\n/g, '<br>') // Satu newline -> line break
                    + '</p>';
            }

            // --- BARU: Fungsi Modal Pesan Kustom ---
            function showAlert(message) {
                alertMessage.textContent = message;
                alertModal.classList.remove('hidden');
            }
            alertOkBtn.addEventListener('click', () => {
                alertModal.classList.add('hidden');
            });

            // --- BARU: Fungsi API Gemini (Tidak berubah, tapi inputnya diubah) ---
            const API_KEY = ""; 
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;
            async function fetchWithBackoff(apiUrl, payload, retries = 3, delay = 1000) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) {
                        if (response.status === 429 && retries > 0) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            return fetchWithBackoff(apiUrl, payload, retries - 1, delay * 2);
                        }
                        throw new Error(`HTTP error! status: ${response.status} ${response.statusText}`);
                    }
                    return response.json();
                } catch (error) {
                    if (retries > 0) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithBackoff(apiUrl, payload, retries - 1, delay * 2);
                    }
                    console.error("Gagal melakukan fetch setelah beberapa kali percobaan:", error);
                    throw error; 
                }
            }
            async function callGemini(prompt, systemInstruction) {
                loadingModal.classList.remove('hidden');
                continueBtn.disabled = true;
                summarizeBtn.disabled = true;
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    systemInstruction: {
                        parts: [{ text: systemInstruction }]
                    }
                };
                try {
                    const result = await fetchWithBackoff(API_URL, payload);
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (!text) {
                        throw new Error("Tidak ada konten yang diterima dari API.");
                    }
                    return text;
                } catch (error) {
                    console.error("Error memanggil Gemini API:", error);
                    showAlert(`Terjadi kesalahan saat menghubungi AI: ${error.message}`);
                    return null;
                } finally {
                    loadingModal.classList.add('hidden');
                    continueBtn.disabled = false;
                    summarizeBtn.disabled = false;
                }
            }
            
            // --- Event Listeners ---

            // 1. PERUBAHAN: Listener input untuk contenteditable
            textInput.addEventListener('input', () => {
                const editorHtml = textInput.innerHTML;
                const generatedHtml = cleanAndProcessHtml(editorHtml);

                htmlOutput.value = generatedHtml; // Panel kanan (Kode)
                tabPreview.innerHTML = generatedHtml; // Panel kanan (Preview)

                // PERUBAHAN: Gunakan innerText untuk statistik
                const plainTextForStats = textInput.innerText; 
                const charCount = plainTextForStats.length;
                const wordCount = plainTextForStats.trim() === '' ? 0 : plainTextForStats.trim().split(/\s+/).filter(Boolean).length;
                stats.textContent = `Karakter: ${charCount} | Kata: ${wordCount}`;
            });

            // HAPUS SELURUH BLOK 'paste' INI
            /*
            // BARU: Menangani 'paste' agar selalu sebagai teks biasa (plain text)
            // Ini untuk mencegah HTML berantakan saat copy-paste dari sumber lain
            textInput.addEventListener('paste', (e) => {
                // Hentikan aksi paste bawaan (yang akan membawa style berantakan)
                e.preventDefault();

                // Ambil data dari clipboard HANYA sebagai teks biasa
                const text = (e.clipboardData || window.clipboardData).getData('text/plain');

                // Masukkan teks biasa tersebut ke editor
                // Ini adalah cara standar untuk menyisipkan teks tanpa format
                document.execCommand('insertText', false, text);

                // Memicu event input secara manual agar panel kanan (HTML) diperbarui
                textInput.dispatchEvent(new Event('input', { bubbles: true }));
            });
            */


            // 2. Tombol "Salin" (Tidak berubah, masih menyalin dari htmlOutput)
            copyBtn.addEventListener('click', () => {
                if (!htmlOutput.value) return; 
                htmlOutput.select();
                htmlOutput.setSelectionRange(0, 99999); 
                try {
                    document.execCommand('copy');
                    copyMessage.classList.remove('hidden');
                    setTimeout(() => copyMessage.classList.add('opacity-100'), 10); 
                    setTimeout(() => {
                        copyMessage.classList.remove('opacity-100');
                        setTimeout(() => copyMessage.classList.add('hidden'), 300); 
                    }, 2000);
                } catch (err) {
                    console.error('Gagal menyalin teks: ', err);
                }
                window.getSelection().removeAllRanges();
            });

            // 3. PERUBAHAN: Tombol "Bersihkan"
            clearBtn.addEventListener('click', () => {
                textInput.innerHTML = ""; // Ganti dari .value ke .innerHTML
                textInput.dispatchEvent(new Event('input', { bubbles: true }));
            });

            // --- PERUBAHAN BESAR: Event Listeners Toolbar Format ---
            // Menggunakan document.execCommand untuk editor WYSIWYG
            
            function applyFormat(command, value = null) {
                // e.preventDefault() mencegah editor kehilangan fokus
                document.execCommand(command, false, value);
                textInput.focus(); // Fokus kembali ke editor
                // Memicu event input secara manual agar panel kanan diperbarui
                textInput.dispatchEvent(new Event('input', { bubbles: true }));
            }

            formatBoldBtn.addEventListener('click', (e) => {
                e.preventDefault();
                applyFormat('bold');
            });

            formatItalicBtn.addEventListener('click', (e) => {
                e.preventDefault();
                applyFormat('italic');
            });

            formatStrikethroughBtn.addEventListener('click', (e) => {
                e.preventDefault();
                applyFormat('strikethrough');
            });

            formatColorBtn.addEventListener('click', (e) => {
                e.preventDefault();
                applyFormat('foreColor', colorPicker.value);
            });

            // --- PERUBAHAN: Event Listeners Tombol Gemini ---
            continueBtn.addEventListener('click', async () => {
                // PERUBAHAN: Gunakan innerText untuk mendapat teks biasa
                const currentText = textInput.innerText; 
                if (!currentText.trim()) {
                    showAlert("Editor masih kosong. Tulis sesuatu untuk dilanjutkan.");
                    return;
                }
                const systemPrompt = "Anda adalah asisten penulis AI. Lanjutkan teks yang diberikan oleh pengguna dengan mulus. Fokus hanya pada penambahan konten baru. JANGAN ulangi teks yang ada. Langsung berikan teks lanjutannya saja tanpa pengantar apa pun.";
                const prompt = `Ini adalah teks yang ada:\n\"\"\"${currentText}\"\"\"\n\Lanjutkan tulisan ini:`;
                
                const continuation = await callGemini(prompt, systemPrompt);
                
                if (continuation) {
                    // PERUBAHAN: Sisipkan HTML ke contenteditable
                    textInput.focus();
                    const htmlToInsert = plainTextToHtmlParagraphs('\n' + continuation.trim());
                    document.execCommand('insertHTML', false, htmlToInsert);
                    
                    textInput.dispatchEvent(new Event('input', { bubbles: true }));
                }
            });

            summarizeBtn.addEventListener('click', async () => {
                // PERUBAHAN: Gunakan innerText
                const currentText = textInput.innerText;
                if (!currentText.trim()) {
                    showAlert("Editor masih kosong. Tulis sesuatu untuk diringkas.");
                    return;
                }
                const systemPrompt = "Anda adalah asisten AI yang ahli meringkas. Buat ringkasan yang jelas dan padat dari teks yang diberikan. Langsung berikan hasil ringkasannya saja tanpa pengantar apa pun.";
                const prompt = `Ringkas teks ini:\n\"\"\"${currentText}\"\"\"`;
                
                const summary = await callGemini(prompt, systemPrompt);
                
                if (summary) {
                    // PERUBAHAN: Set innerHTML dengan paragraf yang diformat
                    textInput.innerHTML = plainTextToHtmlParagraphs(summary.trim());
                    textInput.dispatchEvent(new Event('input', { bubbles: true }));
                }
            });

            // 5. Fungsi Tab (Tidak berubah)
            tabKodeBtn.addEventListener('click', () => {
                tabKode.classList.remove('hidden');
                tabPreview.classList.add('hidden');
                tabKodeBtn.classList.add('bg-slate-700', 'text-cyan-400', 'z-10', 'border-cyan-400');
                tabKodeBtn.classList.remove('bg-slate-800', 'text-slate-400', 'border-slate-700');
                tabPreviewBtn.classList.add('bg-slate-800', 'text-slate-400', 'border-slate-700');
                tabPreviewBtn.classList.remove('bg-slate-700', 'text-cyan-400', 'z-10', 'border-cyan-400');
            });

            tabPreviewBtn.addEventListener('click', () => {
                tabKode.classList.add('hidden');
                tabPreview.classList.remove('hidden');
                tabPreviewBtn.classList.add('bg-slate-700', 'text-cyan-400', 'z-10', 'border-cyan-400');
                tabPreviewBtn.classList.remove('bg-slate-800', 'text-slate-400', 'border-slate-700');
                tabKodeBtn.classList.add('bg-slate-800', 'text-slate-400', 'border-slate-700');
                tabKodeBtn.classList.remove('bg-slate-700', 'text-cyan-400', 'z-10', 'border-cyan-400'); 
            });

        });
    </script>
</body>
</html>
